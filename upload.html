<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload | AmoQuotes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
      font-family: 'Poppins', sans-serif;
      color: white;
    }
    h2 {
      text-align: center;
      margin-bottom: 30px;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #00ffff;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      color: #000;
      font-weight: bold;
    }
    button:hover {
      background: #00dddd;
    }
  </style>
</head>
<body>

  <h2>ðŸ“¤ Upload Content</h2>

  <select id="uploadType">
    <option value="quote">Quote</option>
    <option value="video">Video</option>
  </select>

  <div id="quoteFields">
    <textarea id="quoteText" placeholder="Write your quote..."></textarea>
    <input type="text" id="quoteAuthor" placeholder="Author name (optional)" />
  </div>

  <div id="videoFields" style="display:none;">
    <input type="text" id="videoUrl" placeholder="Video URL (mp4)" />
    <input type="text" id="videoCaption" placeholder="Caption (optional)" />
  </div>

  <button id="uploadBtn">Upload</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import {
      getAuth, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAeWvknhtEkMGyJnEYvmJ1oTzWfgpIdaDg",
      authDomain: "amoqutes.firebaseapp.com",
      projectId: "amoqutes",
      storageBucket: "amoqutes.firebasestorage.app",
      messagingSenderId: "817694015009",
      appId: "1:817694015009:web:488c55ad3b834036882d60",
      measurementId: "G-R0EZ6JZWVM"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();

    const uploadType = document.getElementById("uploadType");
    const quoteFields = document.getElementById("quoteFields");
    const videoFields = document.getElementById("videoFields");
    const uploadBtn = document.getElementById("uploadBtn");

    uploadType.addEventListener("change", () => {
      if (uploadType.value === "quote") {
        quoteFields.style.display = "block";
        videoFields.style.display = "none";
      } else {
        quoteFields.style.display = "none";
        videoFields.style.display = "block";
      }
    });

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        alert("Please login first");
        window.location.href = "login.html";
        return;
      }

      uploadBtn.addEventListener("click", async () => {
        const username = user.displayName || "anonymous";
        const uid = user.uid;

        if (uploadType.value === "quote") {
          const text = document.getElementById("quoteText").value.trim();
          const author = document.getElementById("quoteAuthor").value.trim();
          if (!text) return alert("Quote cannot be empty");

          await addDoc(collection(db, "quotes"), {
            text,
            author,
            username,
            uid,
            timestamp: serverTimestamp()
          });

          await addDoc(collection(db, "notifications"), {
            toUid: uid,
            fromUser: username,
            message: "You posted a new quote!",
            type: "upload",
            timestamp: serverTimestamp()
          });

          alert("Quote uploaded!");
          document.getElementById("quoteText").value = "";
          document.getElementById("quoteAuthor").value = "";

        } else {
          const url = document.getElementById("videoUrl").value.trim();
          const caption = document.getElementById("videoCaption").value.trim();
          if (!url) return alert("Video URL is required");

          await addDoc(collection(db, "videos"), {
            url,
            caption,
            username,
            uid,
            timestamp: serverTimestamp()
          });

          await addDoc(collection(db, "notifications"), {
            toUid: uid,
            fromUser: username,
            message: "You posted a new video!",
            type: "upload",
            timestamp: serverTimestamp()
          });

          alert("Video uploaded!");
          document.getElementById("videoUrl").value = "";
          document.getElementById("videoCaption").value = "";
        }
      });
    });
  </script>

</body>
</html>
